"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.saveJoke = exports.getRandomJoke = exports.jokesGenerator = void 0;
const promises_1 = require("node:fs/promises");
const joke_1 = __importDefault(require("./joke"));
const promises_2 = require("node:fs/promises");
async function loadLocalJoke(file_path) {
    try {
        const jokeStringData = await (0, promises_1.readFile)(file_path, 'utf-8');
        const data = JSON.parse(jokeStringData);
        return data;
    }
    catch (error) {
        return [new joke_1.default("Pourquoi les dÃ©veloppeurs n'aiment-ils pas la nature?", "Parce qu'il y a trop de bugs.", {})];
    }
}
async function saveJoke(file_path, joke) {
    try {
        const data = await loadLocalJoke(file_path);
        if (Array.isArray(joke)) {
            data.push(...joke.map(j => j.toJSON()));
        }
        else {
            data.push(joke.toJSON());
        }
        await (0, promises_2.writeFile)(file_path, JSON.stringify(data, null, 2), 'utf-8');
    }
    catch (error) {
        throw error;
    }
}
exports.saveJoke = saveJoke;
async function* jokesGenerator(file_path) {
    try {
        const jokes = await loadLocalJoke(file_path);
        for (let i = 0; i < jokes.length; i++) {
            yield joke_1.default.fromJSON(jokes[i]);
        }
    }
    catch (error) {
        throw error;
    }
}
exports.jokesGenerator = jokesGenerator;
async function getRandomJoke(file_path) {
    try {
        const jokes = await loadLocalJoke(file_path);
        const randomIndex = Math.floor(Math.random() * jokes.length);
        return joke_1.default.fromJSON(jokes[randomIndex]);
    }
    catch (error) {
        throw error;
    }
}
exports.getRandomJoke = getRandomJoke;
